<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="/js/jquery.justifiedGallery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

<script>
  function galleryRowHeight() {
    return window.innerWidth >= 1024 ? 340 :
           window.innerWidth >= 640  ? 280 : 220;
  }

  function initGallery() {
    const $g = $(".justified-gallery");
    if (!$g.length) return;

    // Re-init safely if needed
    if ($g.data("jg.initialized")) {
      $g.justifiedGallery("destroy");
    }

    $g.justifiedGallery({
      rowHeight: galleryRowHeight(),
      margins: 8,
      lastRow: "nojustify"
    });
  }

  window.addEventListener("load", function () {
    initGallery();

    // Lightbox only if there are any matching links
    if (document.querySelector(".glightbox")) {
      GLightbox({ selector: ".glightbox", touchNavigation: true, loop: true });
    }
  });

  window.addEventListener("resize", function () {
    initGallery();
  });
</script>
